<% provide(:title, 'Forum') %>

<div class="page-header">
  <h3>Рубрики</h3>
</div>



<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">Panel heading</div>

    <table class="table">
      <thread>
          <tr>
            <th width="10%"></th>
            <th width="40%">Forum</th>
            <th width="10%">Topics</th>
            <th width="10%">Comments</th>
            <th width="20%">Last Comment</th>
          </tr>
      </thread>

      <% for rubric in @rubrics %>

      <tbody>
            <tr>
              <td></td>

              <td><p><%= link_to h(rubric.name), rubric_path(rubric.id) %></p>
                <%=h rubric.body %></td>

              <td><%= rubric.topics.count %></td>

              <td>
                <% array=[] %>
                <% rubric.topics.each{|x| array<<x.comments.count} %>
                <% sum = array.inject{|sum, x| sum+x} %>

                <% if sum != nil %>
                  <%= sum %>
                <% else %>
                  <p>0</p>
                <% end %>
              </td>

              <td>
                <% if rubric.topics.any? %>
                  <% topics = rubric.topics %>

                  <%= link_to topics.last.name, topics.last %><br>

                    <% if topics.last.comments.any? %>
                      <%= distance_of_time_in_words_to_now topics.last.comments.last.created_at %> ago by <%= topics.last.comments.last.user.name %>
                    <% end %>

                <% else %>
                    <p>Rubric has no topics</p>
                <% end %>
              </td>

            </tr>
      </tbody>

      <% end %>
    </table>
</div>
